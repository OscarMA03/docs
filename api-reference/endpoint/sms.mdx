---
title: 'SMS Communication'
openapi: 'POST /api/sms'
---

## Get Messages and Generate AI Response

Retrieves conversation history and generates an AI response message. Returns only the AI-generated response.

### Request Body

<ParamField path="body" type="object" name="messageData" required>
  Message retrieval and response data
</ParamField>

<ParamField path="body" type="integer" name="organizationID" required>
  Organization identifier
</ParamField>

<ParamField path="body" type="string" name="customerPhoneNumber" required>
  Customer's phone number
</ParamField>

<ParamField path="body" type="string" name="companyPhoneNumber" required>
  Company's phone number
</ParamField>

<ParamField path="body" type="array" name="locations">
  Array of location objects
</ParamField>

<ParamField path="body" type="integer" name="locations[].id" required>
  Location identifier
</ParamField>

<ParamField path="body" type="string" name="locations[].name">
  Location name
</ParamField>

<ParamField path="body" type="array" name="messages">
  Array of message objects
</ParamField>

<ParamField path="body" type="integer" name="messages[].id" required>
  Message identifier
</ParamField>

<ParamField path="body" type="string" name="messages[].message" required>
  Message content
</ParamField>

<ParamField path="body" type="string" name="messages[].sentBy">
  Sender (customer/company/ai)
</ParamField>

<ParamField path="body" type="string" name="messages[].mediaUrls">
  Comma-separated media URLs
</ParamField>

### Example Request

```bash
POST /api/sms
Content-Type: application/json

{
  "organizationID": 456,
  "customerPhoneNumber": "+1234567890",
  "companyPhoneNumber": "+0987654321",
  "locations": [
    {
      "id": 1,
      "name": "Main Office"
    },
    {
      "id": 2,
      "name": "Branch Office"
    }
  ],
  "messages": [
    {
      "id": 1,
      "message": "Hello, I'd like to schedule an appointment",
      "sentBy": "customer",
      "mediaUrls": ""
    },
    {
      "id": 2,
      "message": "Hi! I'd be happy to help you schedule an appointment. What service are you interested in?",
      "sentBy": "company",
      "mediaUrls": ""
    },
    {
      "id": 3,
      "message": "I need a consultation for my business",
      "sentBy": "customer",
      "mediaUrls": "https://example.com/document.pdf"
    }
  ]
}
```

### Example Response

```json
{
  "success": true,
  "data": {
    "messageId": "msg_ai_123",
    "message": "Thank you for your interest in our business consultation services! I'd be happy to help you schedule an appointment. What specific type of consultation are you looking for?",
    "sentBy": "AI",
    "timestamp": "2024-01-15T10:36:00Z",
    "status": "generated",
    "mediaUrls": []
  },
  "error": null
}
```

### Error Response

```json
{
  "success": false,
  "data": null,
  "error": "Failed to retrieve conversation history or generate AI response"
}
```

### Use Cases

- **AI-Powered Customer Service**: Generate context-aware AI responses based on conversation history
- **Conversation Continuity**: Maintain natural conversation flow with AI assistance
- **Lead Qualification**: AI can analyze conversation history and ask qualifying questions
- **Real-time Support**: Provide instant, context-aware responses to customer inquiries

### Implementation Notes

- The endpoint combines conversation history retrieval with AI response generation
- AI responses are generated based on the conversation context provided
- Messages should be ordered chronologically (oldest first)
- Consider implementing rate limiting for AI response generation
- Media URLs should be validated and accessible
- Timestamps should be in ISO 8601 format
